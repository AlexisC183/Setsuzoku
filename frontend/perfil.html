<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Setsuzoku</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .barra-superior {
            background-color: #2c3e50;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
        }

        .contenedor-principal {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .barra-lateral {
            width: 250px;
            background-color: #34495e;
            color: white;
            height: 100%;
            overflow-y: auto;
            position: relative;
            z-index: 100;
        }

        .boton-menu {
            position: absolute;
            top: 10px;
            right: -40px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 10px;
            cursor: pointer;
            z-index: 101;
        }

        .menu-usuario {
            padding: 20px;
            border-bottom: 1px solid #2c3e50;
        }

        .nombre-usuario {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .rol-usuario {
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        .menu-opciones {
            list-style: none;
            padding: 0;
        }

        .menu-opciones li {
            border-bottom: 1px solid #2c3e50;
        }

        .menu-opciones a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .menu-opciones a:hover {
            background-color: #2c3e50;
        }

        .menu-opciones a.disabled {
            color: #7f8c8d;
            cursor: not-allowed;
        }

        .menu-opciones a.disabled:hover {
            background-color: transparent;
        }

        .contenido-perfil {
            flex: 1;
            padding: 30px;
            background-color: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .titulo-perfil {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .grupo-formulario {
            margin-bottom: 20px;
        }

        .etiqueta-formulario {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
            font-weight: bold;
        }

        .campo-formulario {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .campo-formulario:focus {
            outline: none;
            border-color: #3498db;
        }

        .boton-principal {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .boton-principal:hover {
            background-color: #2980b9;
        }

        .mensaje-exito {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- BARRA SUPERIOR -->
    <nav class="barra-superior">
        <a href="index.html" class="logo">Setsuzoku</a>
    </nav>

    <div class="contenedor-principal">
        <!-- BARRA LATERAL -->
        <div class="barra-lateral">
            <button class="boton-menu" id="boton-menu">☰</button>

            <div class="menu-usuario">
                <div class="nombre-usuario" id="nombre-usuario">Usuario</div>
                <div class="rol-usuario" id="rol-usuario">Rol</div>
            </div>

            <ul class="menu-opciones">
                <li><a href="perfil.html">Perfil</a></li>
                <li><a href="index.html">Menú principal</a></li>
                <li><a href="postulaciones.html" id="enlace-postulaciones">Tus postulaciones</a></li>
                <li><a href="cursos_usuario.html" id="enlace-cursos-usuario">Tus cursos</a></li>
                <li><a href="trabajos.html" id="enlace-trabajos">Trabajos</a></li>
                <li><a href="cursos.html" id="enlace-cursos">Cursos</a></li>
                <li><a href="#" id="cerrar-sesion">Cerrar sesión</a></li>
            </ul>
        </div>

        <!-- CONTENIDO DEL PERFIL -->
        <div class="contenido-perfil">
            <h1 class="titulo-perfil">Mi Perfil</h1>

            <div id="mensaje-exito" class="mensaje-exito"></div>

            <form id="formulario-perfil">
                <div class="grupo-formulario">
                    <label for="nombre" class="etiqueta-formulario">Nombre(s)</label>
                    <input type="text" id="nombre" name="nombre" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="apellido-paterno" class="etiqueta-formulario">Apellido Paterno</label>
                    <input type="text" id="apellido-paterno" name="apellido-paterno" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="apellido-materno" class="etiqueta-formulario">Apellido Materno</label>
                    <input type="text" id="apellido-materno" name="apellido-materno" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="fecha-nacimiento" class="etiqueta-formulario">Fecha de Nacimiento</label>
                    <input type="date" id="fecha-nacimiento" name="fecha-nacimiento" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="genero" class="etiqueta-formulario">Género</label>
                    <select id="genero" name="genero" class="campo-formulario" required>
                        <option value="masculino">Masculino</option>
                        <option value="femenino">Femenino</option>
                        <option value="otro">Otro</option>
                        <option value="no-especificar">Prefiero no especificar</option>
                    </select>
                </div>

                <div class="grupo-formulario">
                    <label for="telefono" class="etiqueta-formulario">Teléfono Celular</label>
                    <input type="tel" id="telefono" name="telefono" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="correo" class="etiqueta-formulario">Correo Electrónico</label>
                    <input type="email" id="correo" name="correo" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="estudios" class="etiqueta-formulario">Últimos Estudios</label>
                    <textarea id="estudios" name="estudios" class="campo-formulario" rows="3" required></textarea>
                </div>

                <div class="grupo-formulario">
                    <label for="experiencia" class="etiqueta-formulario">Experiencia Laboral</label>
                    <textarea id="experiencia" name="experiencia" class="campo-formulario" rows="3" required></textarea>
                </div>

                <div class="grupo-formulario">
                    <label for="habilidades" class="etiqueta-formulario">Habilidades</label>
                    <textarea id="habilidades" name="habilidades" class="campo-formulario" rows="3" required></textarea>
                </div>

                <button type="submit" class="boton-principal">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <script>
        // Función para cargar los datos del usuario
        function cargarDatosUsuario() {
            const usuario = JSON.parse(sessionStorage.getItem('usuario'));

            if (usuario) {
                // Mostrar información del usuario en la barra lateral
                document.getElementById('nombre-usuario').textContent = usuario.nombre;
                document.getElementById('rol-usuario').textContent =
                    usuario.grupo.charAt(0).toUpperCase() + usuario.grupo.slice(1);

                // Configurar opciones según el rol
                configurarMenuSegunRol(usuario.grupo);

                // Cargar datos en el formulario
                document.getElementById('nombre').value = usuario.nombre || '';
                document.getElementById('apellido-paterno').value = usuario.apellido_paterno || '';
                document.getElementById('apellido-materno').value = usuario.apellido_materno || '';
                document.getElementById('fecha-nacimiento').value = usuario.fecha_nacimiento || '';
                document.getElementById('genero').value = usuario.genero || '';
                document.getElementById('telefono').value = usuario.telefono || '';
                document.getElementById('correo').value = usuario.correo || '';
                document.getElementById('estudios').value = usuario.estudios || '';
                document.getElementById('experiencia').value = usuario.experiencia || '';
                document.getElementById('habilidades').value = usuario.habilidades || '';
            } else {
                // Si no hay sesión, redirigir al inicio
                window.location.href = 'index.html';
            }
        }

        // Configurar el menú según el rol del usuario
        function configurarMenuSegunRol(rol) {
            // Por defecto, todos los enlaces están habilitados
            const enlaces = {
                'postulaciones': false,
                'cursos-usuario': false,
                'trabajos': false,
                'cursos': false
            };

            // Configurar según el rol
            switch(rol) {
                case 'candidato':
                    // Los candidatos pueden ver todo excepto "Trabajos" (publicar ofertas)
                    enlaces['trabajos'] = true;
                    break;
                case 'reclutador':
                    // Los reclutadores pueden ver todo excepto "Tus cursos"
                    enlaces['cursos-usuario'] = true;
                    break;
                case 'instructor':
                    // Los instructores pueden ver todo excepto "Tus postulaciones"
                    enlaces['postulaciones'] = true;
                    break;
            }

            // Aplicar la configuración
            for (const [enlace, deshabilitar] of Object.entries(enlaces)) {
                const elemento = document.getElementById(`enlace-${enlace}`);
                if (deshabilitar) {
                    elemento.classList.add('disabled');
                    elemento.setAttribute('href', '#');
                }
            }
        }

        // FUNCIÓN MEJORADA PARA CERRAR SESIÓN
        function cerrarSesion() {
            // Limpiar todos los datos de sesión
            sessionStorage.removeItem('usuario');

            // Redirigir a index.html para forzar recarga completa
            window.location.href = 'index.html';
        }

        // Función para alternar la barra lateral
        function toggleBarraLateral() {
            const barraLateral = document.querySelector('.barra-lateral');
            barraLateral.classList.toggle('abierta');
        }

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos del usuario
            cargarDatosUsuario();

            // Configurar evento para el botón de menú
            document.getElementById('boton-menu').addEventListener('click', toggleBarraLateral);

            // Configurar evento para cerrar sesión
            document.getElementById('cerrar-sesion').addEventListener('click', function(e) {
                e.preventDefault();
                cerrarSesion();
            });

            // Configurar evento para el formulario
            document.getElementById('formulario-perfil').addEventListener('submit', function(e) {
                e.preventDefault();

                // Obtener datos del formulario
                const formData = new FormData(this);
                const datosActualizados = {};

                // Convertir FormData a objeto
                for (let [key, value] of formData.entries()) {
                    datosActualizados[key] = value;
                }

                // Obtener datos actuales del usuario
                const usuarioActual = JSON.parse(sessionStorage.getItem('usuario'));

                // Actualizar datos del usuario
                const usuarioActualizado = {
                    ...usuarioActual,
                    ...datosActualizados
                };

                // Guardar en sessionStorage
                sessionStorage.setItem('usuario', JSON.stringify(usuarioActualizado));

                // Mostrar mensaje de éxito
                const mensajeExito = document.getElementById('mensaje-exito');
                mensajeExito.textContent = 'Perfil actualizado correctamente';
                mensajeExito.style.display = 'block';

                // Ocultar mensaje después de 3 segundos
                setTimeout(() => {
                    mensajeExito.style.display = 'none';
                }, 3000);
            });
        });
    </script>
</body>
</html>