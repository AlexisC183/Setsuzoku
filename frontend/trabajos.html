<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trabajos - Setsuzoku</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .barra-superior {
            background-color: #2c3e50;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
        }

        .contenedor-principal {
            display: flex;
            flex: 1;
            min-height: calc(100vh - 60px); /* Altura total menos la barra superior */
        }

        .barra-lateral {
            width: 250px;
            background-color: #34495e;
            color: white;
            height: 100%;
            overflow-y: auto;
            position: relative;
            z-index: 100;
        }

        .boton-menu {
            position: absolute;
            top: 10px;
            right: -40px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 10px;
            cursor: pointer;
            z-index: 101;
        }

        .menu-usuario {
            padding: 20px;
            border-bottom: 1px solid #2c3e50;
        }

        .nombre-usuario {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .rol-usuario {
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        .menu-opciones {
            list-style: none;
            padding: 0;
        }

        .menu-opciones li {
            border-bottom: 1px solid #2c3e50;
        }

        .menu-opciones a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .menu-opciones a:hover {
            background-color: #2c3e50;
        }

        .menu-opciones a.disabled {
            color: #7f8c8d;
            cursor: not-allowed;
        }

        .menu-opciones a.disabled:hover {
            background-color: transparent;
        }

        .contenido-trabajos {
            flex: 1;
            padding: 30px;
            background-color: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .titulo-trabajos {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .boton-nuevo-trabajo {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .boton-nuevo-trabajo:hover {
            background-color: #229954;
        }

        .lista-trabajos {
            list-style: none;
        }

        .trabajo-item {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .trabajo-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .trabajo-titulo {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .trabajo-empresa {
            font-size: 1rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .trabajo-descripcion {
            margin-bottom: 15px;
            color: #555;
        }

        .trabajo-requisitos {
            margin-bottom: 15px;
        }

        .trabajo-requisitos h4 {
            margin-bottom: 5px;
            color: #34495e;
        }

        .trabajo-requisitos ul {
            padding-left: 20px;
        }

        .trabajo-requisitos li {
            margin-bottom: 5px;
        }

        .trabajo-acciones {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .trabajo-boton {
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
        }

        .boton-ver {
            background-color: #3498db;
            color: white;
        }

        .boton-ver:hover {
            background-color: #2980b9;
        }

        .boton-editar {
            background-color: #f39c12;
            color: white;
        }

        .boton-editar:hover {
            background-color: #d68910;
        }

        .boton-eliminar {
            background-color: #e74c3c;
            color: white;
        }

        .boton-eliminar:hover {
            background-color: #c0392b;
        }

        .mensaje-vacio {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        /* Modal para crear nuevo trabajo */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-contenido {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .modal-cabecera {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-titulo {
            font-size: 1.5rem;
            color: #2c3e50;
        }

        .modal-cerrar {
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        .modal-cerrar:hover {
            color: #2c3e50;
        }

        .grupo-formulario {
            margin-bottom: 15px;
        }

        .etiqueta-formulario {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }

        .campo-formulario {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .campo-formulario:focus {
            outline: none;
            border-color: #3498db;
        }

        .boton-principal {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .boton-principal:hover {
            background-color: #229954;
        }

        .boton-secundario {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            margin-right: 10px;
        }

        .boton-secundario:hover {
            background-color: #7f8c8d;
        }

        .mensaje-exito {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }

        .mensaje-error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- BARRA SUPERIOR -->
    <nav class="barra-superior">
        <a href="index.html" class="logo">Setsuzoku</a>
    </nav>

    <div class="contenedor-principal">
        <!-- BARRA LATERAL -->
        <div class="barra-lateral">
            <button class="boton-menu" id="boton-menu">☰</button>

            <div class="menu-usuario">
                <div class="nombre-usuario" id="nombre-usuario">Usuario</div>
                <div class="rol-usuario" id="rol-usuario">Rol</div>
            </div>

            <ul class="menu-opciones">
                <li><a href="perfil.html">Perfil</a></li>
                <li><a href="index.html">Menú principal</a></li>
                <li><a href="postulaciones.html" id="enlace-postulaciones">Tus postulaciones</a></li>
                <li><a href="cursos_usuario.html" id="enlace-cursos-usuario">Tus cursos</a></li>
                <li><a href="trabajos.html" id="enlace-trabajos">Trabajos</a></li>
                <li><a href="cursos.html" id="enlace-cursos">Cursos</a></li>
                <li><a href="#" id="cerrar-sesion">Cerrar sesión</a></li>
            </ul>
        </div>

        <!-- CONTENIDO DE TRABAJOS -->
        <div class="contenido-trabajos">
            <h1 class="titulo-trabajos">
                Ofertas de Trabajo
                <button class="boton-nuevo-trabajo" id="boton-nuevo-trabajo">Publicar Nuevo Trabajo</button>
            </h1>

            <div id="contenedor-trabajos">
                <!-- Los trabajos se cargarán aquí con JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal para crear nuevo trabajo -->
    <div id="modal-nuevo-trabajo" class="modal">
        <div class="modal-contenido">
            <div class="modal-cabecera">
                <h2 class="modal-titulo">Publicar Nuevo Trabajo</h2>
                <span class="modal-cerrar" id="modal-cerrar">&times;</span>
            </div>
            
            <div id="mensaje-exito" class="mensaje-exito"></div>
            <div id="mensaje-error" class="mensaje-error"></div>
            
            <form id="formulario-nuevo-trabajo">
                <div class="grupo-formulario">
                    <label for="titulo" class="etiqueta-formulario">Título del Puesto</label>
                    <input type="text" id="titulo" name="titulo" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="empresa" class="etiqueta-formulario">Empresa</label>
                    <input type="text" id="empresa" name="empresa" class="campo-formulario" required>
                </div>

                <div class="grupo-formulario">
                    <label for="descripcion" class="etiqueta-formulario">Descripción</label>
                    <textarea id="descripcion" name="descripcion" class="campo-formulario" rows="3" required></textarea>
                </div>

                <div class="grupo-formulario">
                    <label for="requisitos" class="etiqueta-formulario">Requisitos (uno por línea)</label>
                    <textarea id="requisitos" name="requisitos" class="campo-formulario" rows="4" required></textarea>
                </div>

                <div class="grupo-formulario">
                    <button type="submit" class="boton-principal">Publicar Trabajo</button>
                    <button type="button" class="boton-secundario" id="cancelar-nuevo-trabajo">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Función para cargar los datos del usuario
        function cargarDatosUsuario() {
            const usuario = JSON.parse(sessionStorage.getItem('usuario'));

            if (usuario) {
                // Mostrar información del usuario en la barra lateral
                document.getElementById('nombre-usuario').textContent = usuario.nombre;
                document.getElementById('rol-usuario').textContent =
                    usuario.grupo.charAt(0).toUpperCase() + usuario.grupo.slice(1);

                // Configurar opciones según el rol
                configurarMenuSegunRol(usuario.grupo);

                // Cargar trabajos
                cargarTrabajos(usuario.grupo);
            } else {
                // Si no hay sesión, redirigir al inicio
                window.location.href = 'index.html';
            }
        }

        // Configurar el menú según el rol del usuario
        function configurarMenuSegunRol(rolUsuario) {
            // Por defecto, todos los enlaces están habilitados
            const enlaces = {
                'postulaciones': false,
                'cursos-usuario': false,
                'trabajos': false,
                'cursos': false
            };

            // Configurar según el rol
            switch(rolUsuario) {
                case 'candidato':
                    // Los candidatos pueden ver todo excepto "Trabajos" (publicar ofertas)
                    enlaces['trabajos'] = true;
                    break;
                case 'reclutador':
                    // Los reclutadores pueden ver todo excepto "Tus cursos"
                    enlaces['cursos-usuario'] = true;
                    break;
                case 'instructor':
                    // Los instructores pueden ver todo excepto "Tus postulaciones"
                    enlaces['postulaciones'] = true;
                    break;
            }

            // Aplicar la configuración
            for (const [enlace, deshabilitar] of Object.entries(enlaces)) {
                const elemento = document.getElementById(`enlace-${enlace}`);
                if (deshabilitar) {
                    elemento.classList.add('disabled');
                    elemento.setAttribute('href', '#');
                }
            }

            // Si el rol no es reclutador, ocultar el botón de nuevo trabajo
            if (rolUsuario !== 'reclutador') {
                document.getElementById('boton-nuevo-trabajo').style.display = 'none';
            }
        }

        // Función para cargar los trabajos
        function cargarTrabajos(rolUsuario) {
            const contenedorTrabajos = document.getElementById('contenedor-trabajos');

            // Obtener trabajos del servidor
            fetch('/api/trabajos')
                .then(response => response.json())
                .then(trabajos => {
                    // Verificar si hay trabajos
                    if (trabajos.length === 0) {
                        contenedorTrabajos.innerHTML = '<div class="mensaje-vacio">No hay ofertas de trabajo disponibles.</div>';
                        return;
                    }

                    // Crear lista de trabajos
                    const listaTrabajos = document.createElement('ul');
                    listaTrabajos.className = 'lista-trabajos';

                    // Agregar cada trabajo a la lista
                    trabajos.forEach(trabajo => {
                        const itemTrabajo = document.createElement('li');
                        itemTrabajo.className = 'trabajo-item';

                        // Construir HTML del item
                        itemTrabajo.innerHTML = `
                            <h3 class="trabajo-titulo">${trabajo.titulo}</h3>
                            <p class="trabajo-empresa">${trabajo.empresa}</p>
                            <p class="trabajo-descripcion">${trabajo.descripcion}</p>
                            <div class="trabajo-requisitos">
                                <h4>Requisitos:</h4>
                                <ul>
                                    ${trabajo.requisitos.map(req => `<li>${req}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="trabajo-acciones">
                                <button class="trabajo-boton boton-ver" onclick="verDetallesTrabajo(${trabajo.id})">Ver detalles</button>
                                ${rolUsuario === 'reclutador' ? `
                                    <button class="trabajo-boton boton-editar" onclick="editarTrabajo(${trabajo.id})">Editar</button>
                                    <button class="trabajo-boton boton-eliminar" onclick="eliminarTrabajo(${trabajo.id})">Eliminar</button>
                                ` : ''}
                                ${rolUsuario === 'candidato' ? `
                                    <button class="trabajo-boton boton-ver" onclick="postularseTrabajo(${trabajo.id})">Postularse</button>
                                ` : ''}
                            </div>
                        `;

                        listaTrabajos.appendChild(itemTrabajo);
                    });

                    // Agregar lista al contenedor
                    contenedorTrabajos.appendChild(listaTrabajos);
                })
                .catch(error => {
                    console.error('Error al cargar trabajos:', error);
                    contenedorTrabajos.innerHTML = '<div class="mensaje-vacio">Error al cargar las ofertas de trabajo. Por favor intenta más tarde.</div>';
                });
        }

        // Función para ver detalles de un trabajo
        function verDetallesTrabajo(trabajoId) {
            // Obtener detalles del trabajo
            fetch(`/api/trabajos/${trabajoId}`)
                .then(response => response.json())
                .then(trabajo => {
                    // Crear una ventana modal con los detalles
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.style.display = 'block';
                    
                    modal.innerHTML = `
                        <div class="modal-contenido">
                            <div class="modal-cabecera">
                                <h2 class="modal-titulo">${trabajo.titulo}</h2>
                                <span class="modal-cerrar" onclick="this.closest('.modal').remove()">&times;</span>
                            </div>
                            <div class="modal-cuerpo">
                                <p><strong>Empresa:</strong> ${trabajo.empresa}</p>
                                <p><strong>Descripción:</strong> ${trabajo.descripcion}</p>
                                <div>
                                    <strong>Requisitos:</strong>
                                    <ul>
                                        ${trabajo.requisitos.map(req => `<li>${req}</li>`).join('')}
                                    </ul>
                                </div>
                                <p><strong>Fecha de publicación:</strong> ${new Date(trabajo.fecha_publicacion).toLocaleDateString()}</p>
                            </div>
                            <div class="modal-pie">
                                <button class="boton-secundario" onclick="this.closest('.modal').remove()">Cerrar</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Cerrar modal si se hace clic fuera de él
                    modal.addEventListener('click', function(event) {
                        if (event.target === modal) {
                            modal.remove();
                        }
                    });
                })
                .catch(error => {
                    console.error('Error al cargar detalles del trabajo:', error);
                    alert('Error al cargar los detalles del trabajo. Por favor intenta más tarde.');
                });
        }

        // Función para postularse a un trabajo
        function postularseTrabajo(trabajoId) {
            const usuario = JSON.parse(sessionStorage.getItem('usuario'));
            
            if (!usuario) {
                window.location.href = 'index.html';
                return;
            }

            // Enviar solicitud de postulación al servidor
            fetch('/api/postularse-trabajo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    usuario_id: usuario.id,
                    trabajo_id: trabajoId,
                    mensaje: "Estoy interesado en esta posición y creo que mis habilidades son adecuadas."
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.exito) {
                    alert('¡Te has postulado correctamente al trabajo!');
                    // Recargar la página para actualizar la lista de trabajos
                    window.location.reload();
                } else {
                    alert(data.mensaje || 'Error al postularse al trabajo. Por favor intenta nuevamente.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error de conexión. Por favor intenta más tarde.');
            });
        }

        // Función para editar un trabajo
        function editarTrabajo(trabajoId) {
            // Obtener detalles del trabajo
            fetch(`/api/trabajos/${trabajoId}`)
                .then(response => response.json())
                .then(trabajo => {
                    // Crear una ventana modal con el formulario de edición
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.style.display = 'block';
                    
                    modal.innerHTML = `
                        <div class="modal-contenido">
                            <div class="modal-cabecera">
                                <h2 class="modal-titulo">Editar Trabajo</h2>
                                <span class="modal-cerrar" onclick="this.closest('.modal').remove()">&times;</span>
                            </div>
                            <div id="mensaje-exito-editar" class="mensaje-exito"></div>
                            <div id="mensaje-error-editar" class="mensaje-error"></div>
                            <form id="formulario-editar-trabajo">
                                <input type="hidden" id="editar-trabajo-id" value="${trabajo.id}">
                                <div class="grupo-formulario">
                                    <label for="editar-titulo" class="etiqueta-formulario">Título del Puesto</label>
                                    <input type="text" id="editar-titulo" name="titulo" class="campo-formulario" value="${trabajo.titulo}" required>
                                </div>
                                <div class="grupo-formulario">
                                    <label for="editar-empresa" class="etiqueta-formulario">Empresa</label>
                                    <input type="text" id="editar-empresa" name="empresa" class="campo-formulario" value="${trabajo.empresa}" required>
                                </div>
                                <div class="grupo-formulario">
                                    <label for="editar-descripcion" class="etiqueta-formulario">Descripción</label>
                                    <textarea id="editar-descripcion" name="descripcion" class="campo-formulario" rows="3" required>${trabajo.descripcion}</textarea>
                                </div>
                                <div class="grupo-formulario">
                                    <label for="editar-requisitos" class="etiqueta-formulario">Requisitos (uno por línea)</label>
                                    <textarea id="editar-requisitos" name="requisitos" class="campo-formulario" rows="4" required>${trabajo.requisitos.join('\n')}</textarea>
                                </div>
                                <div class="grupo-formulario">
                                    <button type="submit" class="boton-principal">Guardar Cambios</button>
                                    <button type="button" class="boton-secundario" onclick="this.closest('.modal').remove()">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Configurar evento para el formulario
                    document.getElementById('formulario-editar-trabajo').addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const formData = new FormData(this);
                        const datosTrabajo = {
                            id: formData.get('trabajo_id'),
                            titulo: formData.get('titulo'),
                            empresa: formData.get('empresa'),
                            descripcion: formData.get('descripcion'),
                            requisitos: formData.get('requisitos').split('\n').filter(req => req.trim() !== '')
                        };
                        
                        // Enviar datos al servidor
                        fetch(`/api/trabajos/${datosTrabajo.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(datosTrabajo)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.exito) {
                                document.getElementById('mensaje-exito-editar').textContent = 'Trabajo actualizado correctamente.';
                                document.getElementById('mensaje-exito-editar').style.display = 'block';
                                
                                // Recargar la página después de un breve retraso
                                setTimeout(() => {
                                    modal.remove();
                                    window.location.reload();
                                }, 2000);
                            } else {
                                document.getElementById('mensaje-error-editar').textContent = data.mensaje || 'Error al actualizar el trabajo.';
                                document.getElementById('mensaje-error-editar').style.display = 'block';
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            document.getElementById('mensaje-error-editar').textContent = 'Error de conexión. Por favor intenta más tarde.';
                            document.getElementById('mensaje-error-editar').style.display = 'block';
                        });
                    });
                    
                    // Cerrar modal si se hace clic fuera de él
                    modal.addEventListener('click', function(event) {
                        if (event.target === modal) {
                            modal.remove();
                        }
                    });
                })
                .catch(error => {
                    console.error('Error al cargar detalles del trabajo:', error);
                    alert('Error al cargar los detalles del trabajo. Por favor intenta más tarde.');
                });
        }

        // Función para eliminar un trabajo
        function eliminarTrabajo(trabajoId) {
            if (confirm('¿Estás seguro de que deseas eliminar esta oferta de trabajo?')) {
                // Enviar solicitud de eliminación al servidor
                fetch(`/api/trabajos/${trabajoId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        alert('Trabajo eliminado correctamente.');
                        // Recargar la página para actualizar la lista de trabajos
                        window.location.reload();
                    } else {
                        alert(data.mensaje || 'Error al eliminar el trabajo. Por favor intenta nuevamente.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error de conexión. Por favor intenta más tarde.');
                });
            }
        }

        // Función para cerrar sesión
        function cerrarSesion() {
            // Limpiar sessionStorage
            sessionStorage.removeItem('usuario');
            
            // Forzar recarga completa de la página
            window.location.href = 'index.html';
        }

        // Función para alternar la barra lateral
        function toggleBarraLateral() {
            const barraLateral = document.querySelector('.barra-lateral');
            barraLateral.classList.toggle('abierta');
        }

        // Función para abrir el modal de nuevo trabajo
        function abrirModalNuevoTrabajo() {
            document.getElementById('modal-nuevo-trabajo').style.display = 'block';
        }

        // Función para cerrar el modal de nuevo trabajo
        function cerrarModalNuevoTrabajo() {
            document.getElementById('modal-nuevo-trabajo').style.display = 'none';
            document.getElementById('formulario-nuevo-trabajo').reset();
            document.getElementById('mensaje-exito').style.display = 'none';
            document.getElementById('mensaje-error').style.display = 'none';
        }

        // Función para mostrar mensaje de éxito
        function mostrarMensajeExito(mensaje) {
            const mensajeExito = document.getElementById('mensaje-exito');
            mensajeExito.textContent = mensaje;
            mensajeExito.style.display = 'block';

            setTimeout(() => {
                mensajeExito.style.display = 'none';
            }, 5000);
        }

        // Función para mostrar mensaje de error
        function mostrarMensajeError(mensaje) {
            const mensajeError = document.getElementById('mensaje-error');
            mensajeError.textContent = mensaje;
            mensajeError.style.display = 'block';

            setTimeout(() => {
                mensajeError.style.display = 'none';
            }, 5000);
        }

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos del usuario
            cargarDatosUsuario();

            // Configurar evento para el botón de menú
            document.getElementById('boton-menu').addEventListener('click', toggleBarraLateral);

            // Configurar evento para cerrar sesión
            document.getElementById('cerrar-sesion').addEventListener('click', function(e) {
                e.preventDefault();
                cerrarSesion();
            });

            // Configurar evento para el botón de nuevo trabajo
            document.getElementById('boton-nuevo-trabajo').addEventListener('click', abrirModalNuevoTrabajo);

            // Configurar evento para cerrar el modal
            document.getElementById('modal-cerrar').addEventListener('click', cerrarModalNuevoTrabajo);
            document.getElementById('cancelar-nuevo-trabajo').addEventListener('click', cerrarModalNuevoTrabajo);

            // Configurar evento para el formulario de nuevo trabajo
            document.getElementById('formulario-nuevo-trabajo').addEventListener('submit', function(e) {
                e.preventDefault();

                const usuario = JSON.parse(sessionStorage.getItem('usuario'));
                if (!usuario || usuario.grupo !== 'reclutador') {
                    mostrarMensajeError('No tienes permisos para publicar trabajos.');
                    return;
                }

                // Obtener datos del formulario
                const formData = new FormData(this);
                const datosTrabajo = {
                    titulo: formData.get('titulo'),
                    empresa: formData.get('empresa'),
                    descripcion: formData.get('descripcion'),
                    requisitos: formData.get('requisitos').split('\n').filter(req => req.trim() !== ''),
                    reclutador_id: usuario.id,
                    fecha_publicacion: new Date().toISOString(),
                    activo: true
                };

                // Enviar datos al servidor
                fetch('/api/trabajos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(datosTrabajo)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        mostrarMensajeExito('Trabajo publicado correctamente.');
                        // Recargar la página después de un breve retraso
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        mostrarMensajeError(data.mensaje || 'Error al publicar el trabajo. Por favor intenta nuevamente.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    mostrarMensajeError('Error de conexión. Por favor intenta más tarde.');
                });
            });

            // Cerrar modal si se hace clic fuera de él
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('modal-nuevo-trabajo');
                if (event.target === modal) {
                    cerrarModalNuevoTrabajo();
                }
            });
        });
    </script>
</body>
</html>